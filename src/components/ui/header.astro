---
import { Image } from 'astro:assets'

import Avatar from '@/assets/image/avatar.webp'
import ThemeToggle from '@/components/ui/theme-toggle.astro'

interface Props {
  title: string
}

const { title } = Astro.props
---

<header class="sticky top-0 z-50 py-3 backdrop-blur xat-container" transition:name="header">
  <nav class="flex items-center justify-between gap-2">
    <div class="flex grow items-center gap-2">
      <a href="/">
        <Image
          alt="Avatar"
          class="size-10 border border-decoration rounded-full shadow-xl"
          loading="eager"
          src={Avatar}
        />
      </a>
      <h2 class="grow py-2 font-bold opacity-0 transition-opacity transition-duration-500 transition-delay-300 -z-50" id="header-title">{title}</h2>
    </div>
    <ThemeToggle class="opacity-0 transition-delay-0 -z-50" id="header-toggle" />
  </nav>
</header>

<script is:inline>
  // Header Title Scroll to Top
  const header = document.getElementById('header-title')
  header.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' })
  })
  document.addEventListener('astro:after-swap', () => {
    header.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' })
    })
  })
  // Theme Toggle Observer
  const headerToggleObserver = new IntersectionObserver(
    ([entry]) => {
      if (entry.intersectionRatio > 0) {
        document.getElementById('theme-toggle').classList.remove('opacity-0')
        document.getElementById('header-toggle').classList.add('-z-50', 'opacity-0')
        document.getElementById('header-toggle').classList.remove('opacity-100', 'z-100')
      } else {
        document.getElementById('theme-toggle').classList.add('opacity-0')
        document.getElementById('header-toggle').classList.add('opacity-100', 'z-100')
        document.getElementById('header-toggle').classList.remove('-z-50', 'opacity-0')
      }
    },
  )
  headerToggleObserver.observe(document.getElementById('theme-toggle'))
  document.addEventListener('astro:before-swap', () => {
    headerToggleObserver.unobserve(document.getElementById('theme-toggle'))
  })
  document.addEventListener('astro:after-swap', () => {
    headerToggleObserver.observe(document.getElementById('theme-toggle'))
  })
  // Header Title Observer
  const headerTitleObserver = new IntersectionObserver(
    ([entry]) => {
      if (entry.intersectionRatio > 0) {
        document.getElementById('header-title').classList.remove('opacity-100', 'z-50')
        document.getElementById('header-title').classList.add('opacity-0', '-z-50')
      } else {
        document.getElementById('header-title').classList.add('opacity-100', 'z-50')
        document.getElementById('header-title').classList.remove('opacity-0', '-z-50')
      }
    },
  )
  headerTitleObserver.observe(document.getElementById('title'))
  document.addEventListener('astro:before-swap', () => {
    headerTitleObserver.unobserve(document.getElementById('title'))
  })
  document.addEventListener('astro:after-swap', () => {
    headerTitleObserver.observe(document.getElementById('title'))
  })
</script>
